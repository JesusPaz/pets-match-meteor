var require = meteorInstall({"server":{"main.js":function(require,exports,module){

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                              //
// server/main.js                                                                                               //
//                                                                                                              //
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                //
let Meteor;
module.link("meteor/meteor", {
  Meteor(v) {
    Meteor = v;
  }

}, 0);
let WebApp;
module.link("meteor/webapp", {
  WebApp(v) {
    WebApp = v;
  }

}, 1);
let express;
module.link("express", {
  default(v) {
    express = v;
  }

}, 2);
let read;
module.link("fs", {
  read(v) {
    read = v;
  }

}, 3);

var store = require('store');

const app = express();

const bodyParser = require('body-parser');

var MongoClient = require('mongodb').MongoClient;

var ObjectID = require('mongodb').ObjectID;

var db;
const MongoURI = "mongodb+srv://admin:admin@cluster0-n5sgi.mongodb.net/pets-match?retryWrites=true&w=majority";
MongoClient.connect(MongoURI, {
  useUnifiedTopology: true,
  useNewUrlParser: true
}, function (err, database) {
  if (err) throw err;
  db = database.db("pets-match");
  WebApp.connectHandlers.use(app);
});
app.use(bodyParser.urlencoded({
  extended: true
}));
app.use(bodyParser.json()); // Method to login in the server. in the body rcv the user and password

app.post('/api/login', (req, res) => {
  const user = req.body.user;
  const password = req.body.password;
  const users = db.collection("users");
  users.find({
    "user": user
  }).toArray(function (err, result) {
    if (err) {
      console.log(err);
    } else {
      if (result.length == 1) {
        if (result[0].password == password) {
          res.status(200).json({
            message: 'User data is OK'
          });
        } else {
          res.status(401).json({
            message: 'User or password do not match'
          });
        }
      } else {
        res.status(401).json({
          message: 'User do not exists'
        });
      }
    }
  });
}); // Method to sing up in the server. in the body rcv the user and password

app.post('/api/singup', (req, res) => {
  const user = req.body.user;
  const password = req.body.password;
  const email = req.body.email;
  const users = db.collection("users");
  users.find({
    "user": user
  }).toArray(function (err, result) {
    if (err) {
      console.log(err);
    } else {
      if (result.length == 0) {
        var newUser = {
          "user": user,
          "password": password,
          "email": email,
          likePets: [],
          dislikePets: [],
          usersMatch: []
        };
        users.insertOne(newUser, function (err, res) {
          if (err) throw err;
        });
        res.status(200).json({
          message: 'User added successfully'
        });
      } else {
        res.status(401).json({
          message: 'User already exists'
        });
      }
    }
  });
}); // Method to get the next dog

app.get('/api/pets/next/:username', (req, res) => {
  const user = req.params.username;
  const users = db.collection("users");
  const pets = db.collection("pets");
  users.find({
    "user": user
  }).toArray(function (err, result) {
    if (err) {
      console.log(err);
    } else {
      if (result.length == 1 && user) {
        var likePets = result[0].likePets;
        var dislikePets = result[0].dislikePets;
        pets.find({
          "owner": {
            $ne: user
          }
        }).toArray(function (err, result) {
          if (err) {
            console.log(err);
          } else {
            var isPetCorrect = false;
            var timesToFind = 0;
            result.some(function (nextPet) {
              timesToFind++;

              if (likePets.indexOf(nextPet._id.toString()) === -1 && dislikePets.indexOf(nextPet._id.toString()) === -1) {
                res.status(200).json({
                  id: nextPet._id,
                  image: nextPet.image,
                  name: nextPet.name,
                  age: nextPet.age,
                  gender: nextPet.gender,
                  breed: nextPet.breed,
                  isSterialized: nextPet.isSterialized,
                  isReproduced: nextPet.isReproduced,
                  city: nextPet.city,
                  country: nextPet.country,
                  owner: nextPet.owner
                });
                isPetCorrect = true;
              }

              return isPetCorrect;
            });

            if (!isPetCorrect) {
              res.status(401).json({
                message: 'You do not have more pets to see, try it later!'
              });
            }
          }
        });
      } else {
        res.status(401).json({
          message: 'User do not exists'
        });
      }
    }
  });
}); // Method give a like to the actual dog

app.post('/api/pets/like/:username/:idpet', (req, res) => {
  const user = req.params.username;
  const idPet = req.params.idpet;
  const users = db.collection("users");
  users.find({
    "user": user
  }).toArray(function (err, result) {
    if (err) {
      console.log(err);
    } else {
      if (result.length == 1 && user && idPet) {
        users.updateOne({
          "user": user
        }, {
          $addToSet: {
            likePets: {
              $each: [idPet]
            }
          }
        });
        res.status(200).json({
          message: 'Like successfully'
        });
      } else {
        res.status(401).json({
          message: 'Parameters are incorrect'
        });
      }
    }
  });
}); // Method give a dislike to the actual dog

app.post('/api/pets/dislike/:username/:idpet', (req, res) => {
  const user = req.params.username;
  const idPet = req.params.idpet;
  const users = db.collection("users");
  users.find({
    "user": user
  }).toArray(function (err, result) {
    if (err) {
      console.log(err);
    } else {
      if (result.length == 1 && user && idPet) {
        users.updateOne({
          "user": user
        }, {
          $addToSet: {
            dislikePets: {
              $each: [idPet]
            }
          }
        });
        res.status(200).json({
          message: 'Disike successfully'
        });
      } else {
        res.status(401).json({
          message: 'Parameters are incorrect'
        });
      }
    }
  });
}); // Method search if the user given also like your pet (If it's a match)
// user send: user that send a like
// user rcv: user that recv a like

app.get('/api/pets/match/:usersend/:userrcv', (req, res) => {
  const userSend = req.params.usersend;
  const userRcv = req.params.userrcv;
  const users = db.collection("users");
  const pets = db.collection("pets");
  users.find({
    "user": userRcv
  }).toArray(function (err, result) {
    if (err) {
      console.log(err);
    } else {
      if (result.length == 1 && userSend && userRcv) {
        var likePets = result[0].likePets;
        var isMatch = false;
        var count = 0;
        var findPet = likePets.some(function (nextId) {
          return Promise.asyncApply(() => {
            let petOwner = Promise.await(pets.findOne({
              "_id": new ObjectID(nextId)
            }));

            if (petOwner.owner == userSend) {
              isMatch = true;
              res.status(200).json({
                message: "It's a match"
              });
              users.updateOne({
                "user": userRcv
              }, {
                $addToSet: {
                  usersMatch: {
                    $each: [userSend]
                  }
                }
              });
              users.updateOne({
                "user": userSend
              }, {
                $addToSet: {
                  usersMatch: {
                    $each: [userRcv]
                  }
                }
              });
            }

            count++;
            return petOwner.owner == userSend;
          });
        });

        if (!findPet) {
          res.status(200).json({
            message: "It's not a match"
          });
        }
      } else {
        res.status(401).json({
          message: 'Parameters are incorrect'
        });
        console.log("Bad data");
      }
    }
  });
}); // Method for get the pets that a user have register
// user: user that need to show his pets

app.get('/api/mypets/:user', (req, res) => {
  const userparam = req.params.user;
  const pets = db.collection("pets");
  resta = [];
  pets.find({
    "owner": userparam
  }).toArray(function (err, result) {
    if (err) {
      res.status(500).send(err);
    } else {
      result.some(function (nextPet) {
        resta.push(nextPet);
      });
    }

    res.send(resta);
  });
}); // Method for get the pets that a user have register
// user: user that need to show his pets

app.get('/api/mylovers/:user', (req, res) => {
  const userparam = req.params.user;
  const pets = [];
  const users = db.collection("users");
  const petsTotal = db.collection("pets");
  users.find({
    "user": userparam
  }).toArray(function (err, result) {
    if (err) {
      res.status(500).send(err);
    } else {
      result.some(function (nextUser) {
        var matches = nextUser.usersMatch;

        for (let i = 0; i < matches.length; i++) {
          petsTotal.find({
            "owner": matches[i]
          }).toArray(function (err, result1) {
            if (err) {
              res.status(500).send(err);
            } else {
              result1.some(function (nextPet) {
                pets.push(nextPet);
              });
            }

            res.send(pets);
          });
        }
      });
    }
  });
}); // Method to sing up in the server. in the body rcv the user and password

app.post('/api/addpet', (req, res) => {
  const pet = req.body.pet;
  const pets = db.collection("pets");
  pets.insertOne(pet, function (err, response) {
    if (err) {
      res.send(err);
    } else {
      res.status(200).send(response);
    }
  });
});
app.post('/api/delete/:_id', (req, res) => {
  const userParam = req.params._id;
  const pets = db.collection("pets");
  pets.deleteOne({
    "_id": ObjectID(userParam)
  }, (err, result) => {
    if (err) {
      res.send(err);
    } else {
      res.status(200);
    }
  });
  res.status(200);
}); //load or create new chat if does not exist a previos chat conversation

app.post('/api/chat/:participantA/:participantB', (req, res) => Promise.asyncApply(() => {
  const userA = req.params.participantA;
  const userB = req.params.participantB;
  const chats = db.collection("chats");
  let actChat = Promise.await(chats.findOne({
    $or: [{
      $and: [{
        participantA: userA
      }, {
        participantB: userB
      }]
    }, {
      $and: [{
        participantA: userB
      }, {
        participantB: userA
      }]
    }]
  })); // if the chat exists

  if (actChat != null) {
    res.status(200).send(actChat.messages);
  } else {
    var newChat = {
      "participantA": userA,
      "participantB": userB,
      messages: []
    };
    chats.insertOne(newChat, function (err, res) {
      if (err) throw err;
    });
    var messages = [];
    res.status(200).send(messages);
  }
})); // Add a new message to the conversation

app.post('/api/chat/addmsg/:participantA/:participantB/:msg', (req, res) => Promise.asyncApply(() => {
  const userA = req.params.participantA;
  const userB = req.params.participantB;
  const msg = req.params.msg;
  const chats = db.collection("chats");
  let actChat = Promise.await(chats.findOne({
    $or: [{
      $and: [{
        participantA: userA
      }, {
        participantB: userB
      }]
    }, {
      $and: [{
        participantA: userB
      }, {
        participantB: userA
      }]
    }]
  })); // if the chat exists

  if (actChat != null) {
    chats.updateOne({
      $or: [{
        $and: [{
          participantA: userA
        }, {
          participantB: userB
        }]
      }, {
        $and: [{
          participantA: userB
        }, {
          participantB: userA
        }]
      }]
    }, {
      $addToSet: {
        messages: {
          $each: [msg]
        }
      }
    });
    let actChat = Promise.await(chats.findOne({
      $or: [{
        $and: [{
          participantA: userA
        }, {
          participantB: userB
        }]
      }, {
        $and: [{
          participantA: userB
        }, {
          participantB: userA
        }]
      }]
    }));
    res.status(200).send(actChat.messages);
  } else {
    res.status(500).send("The chat do not exists");
  }
}));
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}}},{
  "extensions": [
    ".js",
    ".json",
    ".vue"
  ]
});

var exports = require("/server/main.js");
//# sourceURL=meteor://ðŸ’»app/app/app.js
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1ldGVvcjovL/CfkrthcHAvc2VydmVyL21haW4uanMiXSwibmFtZXMiOlsiTWV0ZW9yIiwibW9kdWxlIiwibGluayIsInYiLCJXZWJBcHAiLCJleHByZXNzIiwiZGVmYXVsdCIsInJlYWQiLCJzdG9yZSIsInJlcXVpcmUiLCJhcHAiLCJib2R5UGFyc2VyIiwiTW9uZ29DbGllbnQiLCJPYmplY3RJRCIsImRiIiwiTW9uZ29VUkkiLCJjb25uZWN0IiwidXNlVW5pZmllZFRvcG9sb2d5IiwidXNlTmV3VXJsUGFyc2VyIiwiZXJyIiwiZGF0YWJhc2UiLCJjb25uZWN0SGFuZGxlcnMiLCJ1c2UiLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJqc29uIiwicG9zdCIsInJlcSIsInJlcyIsInVzZXIiLCJib2R5IiwicGFzc3dvcmQiLCJ1c2VycyIsImNvbGxlY3Rpb24iLCJmaW5kIiwidG9BcnJheSIsInJlc3VsdCIsImNvbnNvbGUiLCJsb2ciLCJsZW5ndGgiLCJzdGF0dXMiLCJtZXNzYWdlIiwiZW1haWwiLCJuZXdVc2VyIiwibGlrZVBldHMiLCJkaXNsaWtlUGV0cyIsInVzZXJzTWF0Y2giLCJpbnNlcnRPbmUiLCJnZXQiLCJwYXJhbXMiLCJ1c2VybmFtZSIsInBldHMiLCIkbmUiLCJpc1BldENvcnJlY3QiLCJ0aW1lc1RvRmluZCIsInNvbWUiLCJuZXh0UGV0IiwiaW5kZXhPZiIsIl9pZCIsInRvU3RyaW5nIiwiaWQiLCJpbWFnZSIsIm5hbWUiLCJhZ2UiLCJnZW5kZXIiLCJicmVlZCIsImlzU3RlcmlhbGl6ZWQiLCJpc1JlcHJvZHVjZWQiLCJjaXR5IiwiY291bnRyeSIsIm93bmVyIiwiaWRQZXQiLCJpZHBldCIsInVwZGF0ZU9uZSIsIiRhZGRUb1NldCIsIiRlYWNoIiwidXNlclNlbmQiLCJ1c2Vyc2VuZCIsInVzZXJSY3YiLCJ1c2VycmN2IiwiaXNNYXRjaCIsImNvdW50IiwiZmluZFBldCIsIm5leHRJZCIsInBldE93bmVyIiwiZmluZE9uZSIsInVzZXJwYXJhbSIsInJlc3RhIiwic2VuZCIsInB1c2giLCJwZXRzVG90YWwiLCJuZXh0VXNlciIsIm1hdGNoZXMiLCJpIiwicmVzdWx0MSIsInBldCIsInJlc3BvbnNlIiwidXNlclBhcmFtIiwiZGVsZXRlT25lIiwidXNlckEiLCJwYXJ0aWNpcGFudEEiLCJ1c2VyQiIsInBhcnRpY2lwYW50QiIsImNoYXRzIiwiYWN0Q2hhdCIsIiRvciIsIiRhbmQiLCJtZXNzYWdlcyIsIm5ld0NoYXQiLCJtc2ciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBSUEsTUFBSjtBQUFXQyxNQUFNLENBQUNDLElBQVAsQ0FBWSxlQUFaLEVBQTRCO0FBQUNGLFFBQU0sQ0FBQ0csQ0FBRCxFQUFHO0FBQUNILFVBQU0sR0FBQ0csQ0FBUDtBQUFTOztBQUFwQixDQUE1QixFQUFrRCxDQUFsRDtBQUFxRCxJQUFJQyxNQUFKO0FBQVdILE1BQU0sQ0FBQ0MsSUFBUCxDQUFZLGVBQVosRUFBNEI7QUFBQ0UsUUFBTSxDQUFDRCxDQUFELEVBQUc7QUFBQ0MsVUFBTSxHQUFDRCxDQUFQO0FBQVM7O0FBQXBCLENBQTVCLEVBQWtELENBQWxEO0FBQXFELElBQUlFLE9BQUo7QUFBWUosTUFBTSxDQUFDQyxJQUFQLENBQVksU0FBWixFQUFzQjtBQUFDSSxTQUFPLENBQUNILENBQUQsRUFBRztBQUFDRSxXQUFPLEdBQUNGLENBQVI7QUFBVTs7QUFBdEIsQ0FBdEIsRUFBOEMsQ0FBOUM7QUFBaUQsSUFBSUksSUFBSjtBQUFTTixNQUFNLENBQUNDLElBQVAsQ0FBWSxJQUFaLEVBQWlCO0FBQUNLLE1BQUksQ0FBQ0osQ0FBRCxFQUFHO0FBQUNJLFFBQUksR0FBQ0osQ0FBTDtBQUFPOztBQUFoQixDQUFqQixFQUFtQyxDQUFuQzs7QUFLdE0sSUFBSUssS0FBSyxHQUFHQyxPQUFPLENBQUMsT0FBRCxDQUFuQjs7QUFDQSxNQUFNQyxHQUFHLEdBQUdMLE9BQU8sRUFBbkI7O0FBQ0EsTUFBTU0sVUFBVSxHQUFHRixPQUFPLENBQUMsYUFBRCxDQUExQjs7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QTFCO0FBQVIsT0FERyxFQUVIO0FBQUVLLFlBQUksRUFBRSxDQUFDO0FBQUVOLHNCQUFZLEVBQUVDO0FBQWhCLFNBQUQsRUFBMEI7QUFBRUMsc0JBQVksRUFBRUg7QUFBaEIsU0FBMUI7QUFBUixPQUZHO0FBRFAsS0FERixFQU9FO0FBQUV6QixlQUFTLEVBQUU7QUFBRWlDLGdCQUFRLEVBQUU7QUFBRWhDLGVBQUssRUFBRSxDQUFDa0MsR0FBRDtBQUFUO0FBQVo7QUFBYixLQVBGO0FBVUEsUUFBSUwsT0FBTyxpQkFBU0QsS0FBSyxDQUFDbEIsT0FBTixDQUFjO0FBQ2hDb0IsU0FBRyxFQUFFLENBQ0g7QUFBRUMsWUFBSSxFQUFFLENBQUM7QUFBRU4sc0JBQVksRUFBRUQ7QUFBaEIsU0FBRCxFQUEwQjtBQUFFRyxzQkFBWSxFQUFFRDtBQUFoQixTQUExQjtBQUFSLE9BREcsRUFFSDtBQUFFSyxZQUFJLEVBQUUsQ0FBQztBQUFFTixzQkFBWSxFQUFFQztBQUFoQixTQUFELEVBQTBCO0FBQUVDLHNCQUFZLEVBQUVIO0FBQWhCLFNBQTFCO0FBQVIsT0FGRztBQUQyQixLQUFkLENBQVQsQ0FBWDtBQU9BdkUsT0FBRyxDQUFDWSxNQUFKLENBQVcsR0FBWCxFQUFnQmdELElBQWhCLENBQXFCZ0IsT0FBTyxDQUFDRyxRQUE3QjtBQUdELEdBdEJELE1Bc0JPO0FBQ0wvRSxPQUFHLENBQUNZLE1BQUosQ0FBVyxHQUFYLEVBQWdCZ0QsSUFBaEIsQ0FBcUIsd0JBQXJCO0FBQ0Q7QUFDRixDQXZDNkQsQ0FBOUQsRSIsImZpbGUiOiIvYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWV0ZW9yIH0gZnJvbSAnbWV0ZW9yL21ldGVvcic7XG5pbXBvcnQgeyBXZWJBcHAgfSBmcm9tICdtZXRlb3Ivd2ViYXBwJztcbmltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgcmVhZCB9IGZyb20gJ2ZzJztcblxudmFyIHN0b3JlID0gcmVxdWlyZSgnc3RvcmUnKVxuY29uc3QgYXBwID0gZXhwcmVzcygpO1xuY29uc3QgYm9keVBhcnNlciA9IHJlcXVpcmUoJ2JvZHktcGFyc2VyJyk7XG52YXIgTW9uZ29DbGllbnQgPSByZXF1aXJlKCdtb25nb2RiJykuTW9uZ29DbGllbnQ7XG52YXIgT2JqZWN0SUQgPSByZXF1aXJlKCdtb25nb2RiJykuT2JqZWN0SUQ7XG52YXIgZGI7XG5jb25zdCBNb25nb1VSSSA9IFwibW9uZ29kYitzcnY6Ly9hZG1pbjphZG1pbkBjbHVzdGVyMC1uNXNnaS5tb25nb2RiLm5ldC9wZXRzLW1hdGNoP3JldHJ5V3JpdGVzPXRydWUmdz1tYWpvcml0eVwiO1xuXG5Nb25nb0NsaWVudC5jb25uZWN0KE1vbmdvVVJJLCB7IHVzZVVuaWZpZWRUb3BvbG9neTogdHJ1ZSwgdXNlTmV3VXJsUGFyc2VyOiB0cnVlLCB9LFxuICBmdW5jdGlvbiAoZXJyLCBkYXRhYmFzZSkge1xuICAgIGlmIChlcnIpIHRocm93IGVycjtcblxuICAgIGRiID0gZGF0YWJhc2UuZGIoXCJwZXRzLW1hdGNoXCIpO1xuICAgIFdlYkFwcC5jb25uZWN0SGFuZGxlcnMudXNlKGFwcCk7XG4gIH0pO1xuXG5hcHAudXNlKFxuICBib2R5UGFyc2VyLnVybGVuY29kZWQoe1xuICAgIGV4dGVuZGVkOiB0cnVlXG4gIH0pXG4pXG5hcHAudXNlKGJvZHlQYXJzZXIuanNvbigpKVxuXG4vLyBNZXRob2QgdG8gbG9naW4gaW4gdGhlIHNlcnZlci4gaW4gdGhlIGJvZHkgcmN2IHRoZSB1c2VyIGFuZCBwYXNzd29yZFxuYXBwLnBvc3QoJy9hcGkvbG9naW4nLCAocmVxLCByZXMpID0+IHtcblxuICBjb25zdCB1c2VyID0gcmVxLmJvZHkudXNlclxuICBjb25zdCBwYXNzd29yZCA9IHJlcS5ib2R5LnBhc3N3b3JkXG5cbiAgY29uc3QgdXNlcnMgPSBkYi5jb2xsZWN0aW9uKFwidXNlcnNcIik7XG5cbiAgdXNlcnMuZmluZCh7IFwidXNlclwiOiB1c2VyIH0pLnRvQXJyYXkoZnVuY3Rpb24gKGVyciwgcmVzdWx0KSB7XG4gICAgaWYgKGVycikge1xuICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PSAxKSB7XG4gICAgICAgIGlmIChyZXN1bHRbMF0ucGFzc3dvcmQgPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIGRhdGEgaXMgT0snIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ1VzZXIgb3IgcGFzc3dvcmQgZG8gbm90IG1hdGNoJyB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBkbyBub3QgZXhpc3RzJyB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufSk7XG5cblxuLy8gTWV0aG9kIHRvIHNpbmcgdXAgaW4gdGhlIHNlcnZlci4gaW4gdGhlIGJvZHkgcmN2IHRoZSB1c2VyIGFuZCBwYXNzd29yZFxuYXBwLnBvc3QoJy9hcGkvc2luZ3VwJywgKHJlcSwgcmVzKSA9PiB7XG5cbiAgY29uc3QgdXNlciA9IHJlcS5ib2R5LnVzZXJcbiAgY29uc3QgcGFzc3dvcmQgPSByZXEuYm9keS5wYXNzd29yZFxuICBjb25zdCBlbWFpbCA9IHJlcS5ib2R5LmVtYWlsXG5cbiAgY29uc3QgdXNlcnMgPSBkYi5jb2xsZWN0aW9uKFwidXNlcnNcIik7XG5cbiAgdXNlcnMuZmluZCh7IFwidXNlclwiOiB1c2VyIH0pLnRvQXJyYXkoZnVuY3Rpb24gKGVyciwgcmVzdWx0KSB7XG4gICAgaWYgKGVycikge1xuICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PSAwKSB7XG5cbiAgICAgICAgdmFyIG5ld1VzZXIgPSB7XG4gICAgICAgICAgXCJ1c2VyXCI6IHVzZXIsIFwicGFzc3dvcmRcIjogcGFzc3dvcmQsIFwiZW1haWxcIjogZW1haWwsIGxpa2VQZXRzOiBbXSxcbiAgICAgICAgICBkaXNsaWtlUGV0czogW10sIHVzZXJzTWF0Y2g6IFtdXG4gICAgICAgIH07XG5cbiAgICAgICAgdXNlcnMuaW5zZXJ0T25lKG5ld1VzZXIsIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgICAgICAgIGlmIChlcnIpIHRocm93IGVycjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiAnVXNlciBhZGRlZCBzdWNjZXNzZnVsbHknIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBhbHJlYWR5IGV4aXN0cycgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn0pO1xuXG5cbi8vIE1ldGhvZCB0byBnZXQgdGhlIG5leHQgZG9nXG5hcHAuZ2V0KCcvYXBpL3BldHMvbmV4dC86dXNlcm5hbWUnLCAocmVxLCByZXMpID0+IHtcblxuICBjb25zdCB1c2VyID0gcmVxLnBhcmFtcy51c2VybmFtZVxuXG4gIGNvbnN0IHVzZXJzID0gZGIuY29sbGVjdGlvbihcInVzZXJzXCIpO1xuICBjb25zdCBwZXRzID0gZGIuY29sbGVjdGlvbihcInBldHNcIik7XG5cbiAgdXNlcnMuZmluZCh7IFwidXNlclwiOiB1c2VyIH0pLnRvQXJyYXkoZnVuY3Rpb24gKGVyciwgcmVzdWx0KSB7XG4gICAgaWYgKGVycikge1xuICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PSAxICYmIHVzZXIpIHtcbiAgICAgICAgdmFyIGxpa2VQZXRzID0gcmVzdWx0WzBdLmxpa2VQZXRzO1xuICAgICAgICB2YXIgZGlzbGlrZVBldHMgPSByZXN1bHRbMF0uZGlzbGlrZVBldHNcblxuICAgICAgICBwZXRzLmZpbmQoeyBcIm93bmVyXCI6IHsgJG5lOiB1c2VyIH0gfSkudG9BcnJheShmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBpc1BldENvcnJlY3QgPSBmYWxzZVxuICAgICAgICAgICAgdmFyIHRpbWVzVG9GaW5kID0gMFxuICAgICAgICAgICAgcmVzdWx0LnNvbWUoZnVuY3Rpb24gKG5leHRQZXQpIHtcbiAgICAgICAgICAgICAgdGltZXNUb0ZpbmQrK1xuICAgICAgICAgICAgICBpZiAobGlrZVBldHMuaW5kZXhPZihuZXh0UGV0Ll9pZC50b1N0cmluZygpKSA9PT0gLTEgJiYgZGlzbGlrZVBldHMuaW5kZXhPZihuZXh0UGV0Ll9pZC50b1N0cmluZygpKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgICAgICAgICAgICBpZDogbmV4dFBldC5faWQsXG4gICAgICAgICAgICAgICAgICBpbWFnZTogbmV4dFBldC5pbWFnZSxcbiAgICAgICAgICAgICAgICAgIG5hbWU6IG5leHRQZXQubmFtZSxcbiAgICAgICAgICAgICAgICAgIGFnZTogbmV4dFBldC5hZ2UsXG4gICAgICAgICAgICAgICAgICBnZW5kZXI6IG5leHRQZXQuZ2VuZGVyLFxuICAgICAgICAgICAgICAgICAgYnJlZWQ6IG5leHRQZXQuYnJlZWQsXG4gICAgICAgICAgICAgICAgICBpc1N0ZXJpYWxpemVkOiBuZXh0UGV0LmlzU3RlcmlhbGl6ZWQsXG4gICAgICAgICAgICAgICAgICBpc1JlcHJvZHVjZWQ6IG5leHRQZXQuaXNSZXByb2R1Y2VkLFxuICAgICAgICAgICAgICAgICAgY2l0eTogbmV4dFBldC5jaXR5LFxuICAgICAgICAgICAgICAgICAgY291bnRyeTogbmV4dFBldC5jb3VudHJ5LFxuICAgICAgICAgICAgICAgICAgb3duZXI6IG5leHRQZXQub3duZXJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpc1BldENvcnJlY3QgPSB0cnVlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIGlzUGV0Q29ycmVjdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIWlzUGV0Q29ycmVjdCkge1xuICAgICAgICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdZb3UgZG8gbm90IGhhdmUgbW9yZSBwZXRzIHRvIHNlZSwgdHJ5IGl0IGxhdGVyIScgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBkbyBub3QgZXhpc3RzJyB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufSk7XG5cblxuLy8gTWV0aG9kIGdpdmUgYSBsaWtlIHRvIHRoZSBhY3R1YWwgZG9nXG5hcHAucG9zdCgnL2FwaS9wZXRzL2xpa2UvOnVzZXJuYW1lLzppZHBldCcsIChyZXEsIHJlcykgPT4ge1xuXG4gIGNvbnN0IHVzZXIgPSByZXEucGFyYW1zLnVzZXJuYW1lXG4gIGNvbnN0IGlkUGV0ID0gcmVxLnBhcmFtcy5pZHBldFxuICBjb25zdCB1c2VycyA9IGRiLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKTtcblxuICB1c2Vycy5maW5kKHsgXCJ1c2VyXCI6IHVzZXIgfSkudG9BcnJheShmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChyZXN1bHQubGVuZ3RoID09IDEgJiYgdXNlciAmJiBpZFBldCkge1xuXG4gICAgICAgIHVzZXJzLnVwZGF0ZU9uZShcbiAgICAgICAgICB7IFwidXNlclwiOiB1c2VyIH0sXG4gICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgbGlrZVBldHM6IHsgJGVhY2g6IFtpZFBldF0gfSB9IH1cbiAgICAgICAgKVxuXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbWVzc2FnZTogJ0xpa2Ugc3VjY2Vzc2Z1bGx5JyB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ1BhcmFtZXRlcnMgYXJlIGluY29ycmVjdCcgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn0pO1xuXG5cbi8vIE1ldGhvZCBnaXZlIGEgZGlzbGlrZSB0byB0aGUgYWN0dWFsIGRvZ1xuYXBwLnBvc3QoJy9hcGkvcGV0cy9kaXNsaWtlLzp1c2VybmFtZS86aWRwZXQnLCAocmVxLCByZXMpID0+IHtcblxuICBjb25zdCB1c2VyID0gcmVxLnBhcmFtcy51c2VybmFtZVxuICBjb25zdCBpZFBldCA9IHJlcS5wYXJhbXMuaWRwZXRcbiAgY29uc3QgdXNlcnMgPSBkYi5jb2xsZWN0aW9uKFwidXNlcnNcIik7XG5cbiAgdXNlcnMuZmluZCh7IFwidXNlclwiOiB1c2VyIH0pLnRvQXJyYXkoZnVuY3Rpb24gKGVyciwgcmVzdWx0KSB7XG4gICAgaWYgKGVycikge1xuICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PSAxICYmIHVzZXIgJiYgaWRQZXQpIHtcblxuICAgICAgICB1c2Vycy51cGRhdGVPbmUoXG4gICAgICAgICAgeyBcInVzZXJcIjogdXNlciB9LFxuICAgICAgICAgIHsgJGFkZFRvU2V0OiB7IGRpc2xpa2VQZXRzOiB7ICRlYWNoOiBbaWRQZXRdIH0gfSB9XG4gICAgICAgIClcblxuICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6ICdEaXNpa2Ugc3VjY2Vzc2Z1bGx5JyB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ1BhcmFtZXRlcnMgYXJlIGluY29ycmVjdCcgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn0pO1xuXG5cblxuLy8gTWV0aG9kIHNlYXJjaCBpZiB0aGUgdXNlciBnaXZlbiBhbHNvIGxpa2UgeW91ciBwZXQgKElmIGl0J3MgYSBtYXRjaClcbi8vIHVzZXIgc2VuZDogdXNlciB0aGF0IHNlbmQgYSBsaWtlXG4vLyB1c2VyIHJjdjogdXNlciB0aGF0IHJlY3YgYSBsaWtlXG5hcHAuZ2V0KCcvYXBpL3BldHMvbWF0Y2gvOnVzZXJzZW5kLzp1c2VycmN2JywgKHJlcSwgcmVzKSA9PiB7XG5cbiAgY29uc3QgdXNlclNlbmQgPSByZXEucGFyYW1zLnVzZXJzZW5kXG4gIGNvbnN0IHVzZXJSY3YgPSByZXEucGFyYW1zLnVzZXJyY3ZcblxuICBjb25zdCB1c2VycyA9IGRiLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKTtcbiAgY29uc3QgcGV0cyA9IGRiLmNvbGxlY3Rpb24oXCJwZXRzXCIpO1xuXG4gIHVzZXJzLmZpbmQoeyBcInVzZXJcIjogdXNlclJjdiB9KS50b0FycmF5KGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPT0gMSAmJiB1c2VyU2VuZCAmJiB1c2VyUmN2KSB7XG4gICAgICAgIHZhciBsaWtlUGV0cyA9IHJlc3VsdFswXS5saWtlUGV0cztcbiAgICAgICAgdmFyIGlzTWF0Y2ggPSBmYWxzZVxuICAgICAgICB2YXIgY291bnQgPSAwXG4gICAgICAgIHZhciBmaW5kUGV0ID0gbGlrZVBldHMuc29tZShhc3luYyBmdW5jdGlvbiAobmV4dElkKSB7XG4gICAgICAgICAgbGV0IHBldE93bmVyID0gYXdhaXQgcGV0cy5maW5kT25lKHsgXCJfaWRcIjogbmV3IE9iamVjdElEKG5leHRJZCkgfSlcbiAgICAgICAgICBpZiAocGV0T3duZXIub3duZXIgPT0gdXNlclNlbmQpIHtcbiAgICAgICAgICAgIGlzTWF0Y2ggPSB0cnVlXG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6IFwiSXQncyBhIG1hdGNoXCIgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHVzZXJzLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgeyBcInVzZXJcIjogdXNlclJjdiB9LFxuICAgICAgICAgICAgICB7ICRhZGRUb1NldDogeyB1c2Vyc01hdGNoOiB7ICRlYWNoOiBbdXNlclNlbmRdIH0gfSB9XG4gICAgICAgICAgICApXG5cbiAgICAgICAgICAgIHVzZXJzLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgeyBcInVzZXJcIjogdXNlclNlbmQgfSxcbiAgICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgdXNlcnNNYXRjaDogeyAkZWFjaDogW3VzZXJSY3ZdIH0gfSB9XG4gICAgICAgICAgICApXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY291bnQrK1xuICAgICAgICAgIHJldHVybiBwZXRPd25lci5vd25lciA9PSB1c2VyU2VuZFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFmaW5kUGV0KSB7XG4gICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiBcIkl0J3Mgbm90IGEgbWF0Y2hcIiB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnUGFyYW1ldGVycyBhcmUgaW5jb3JyZWN0JyB9KTtcbiAgICAgICAgY29uc29sZS5sb2coXCJCYWQgZGF0YVwiKVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbn0pO1xuXG5cblxuLy8gTWV0aG9kIGZvciBnZXQgdGhlIHBldHMgdGhhdCBhIHVzZXIgaGF2ZSByZWdpc3RlclxuLy8gdXNlcjogdXNlciB0aGF0IG5lZWQgdG8gc2hvdyBoaXMgcGV0c1xuYXBwLmdldCgnL2FwaS9teXBldHMvOnVzZXInLCAocmVxLCByZXMpID0+IHtcblxuICBjb25zdCB1c2VycGFyYW0gPSByZXEucGFyYW1zLnVzZXJcbiAgY29uc3QgcGV0cyA9IGRiLmNvbGxlY3Rpb24oXCJwZXRzXCIpO1xuXG4gIHJlc3RhID0gW107XG5cbiAgcGV0cy5maW5kKHsgXCJvd25lclwiOiB1c2VycGFyYW0gfSkudG9BcnJheShmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChlcnIpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHQuc29tZShmdW5jdGlvbiAobmV4dFBldCkge1xuICAgICAgICByZXN0YS5wdXNoKG5leHRQZXQpO1xuICAgICAgfSk7XG5cbiAgICB9XG4gICAgcmVzLnNlbmQocmVzdGEpO1xuICB9KTtcblxufSk7XG5cblxuLy8gTWV0aG9kIGZvciBnZXQgdGhlIHBldHMgdGhhdCBhIHVzZXIgaGF2ZSByZWdpc3RlclxuLy8gdXNlcjogdXNlciB0aGF0IG5lZWQgdG8gc2hvdyBoaXMgcGV0c1xuYXBwLmdldCgnL2FwaS9teWxvdmVycy86dXNlcicsIChyZXEsIHJlcykgPT4ge1xuXG4gIGNvbnN0IHVzZXJwYXJhbSA9IHJlcS5wYXJhbXMudXNlclxuXG4gIGNvbnN0IHBldHMgPSBbXTtcblxuICBjb25zdCB1c2VycyA9IGRiLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKTtcbiAgY29uc3QgcGV0c1RvdGFsID0gZGIuY29sbGVjdGlvbihcInBldHNcIik7XG5cbiAgdXNlcnMuZmluZCh7IFwidXNlclwiOiB1c2VycGFyYW0gfSkudG9BcnJheShmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChlcnIpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHQuc29tZShmdW5jdGlvbiAobmV4dFVzZXIpIHtcbiAgICAgICAgdmFyIG1hdGNoZXMgPSBuZXh0VXNlci51c2Vyc01hdGNoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1hdGNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBwZXRzVG90YWwuZmluZCh7IFwib3duZXJcIjogbWF0Y2hlc1tpXSB9KS50b0FycmF5KGZ1bmN0aW9uIChlcnIsIHJlc3VsdDEpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoZXJyKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlc3VsdDEuc29tZShmdW5jdGlvbiAobmV4dFBldCkge1xuICAgICAgICAgICAgICAgIHBldHMucHVzaChuZXh0UGV0KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXMuc2VuZChwZXRzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICB9XG5cbiAgfSk7XG59KTtcblxuXG5cbi8vIE1ldGhvZCB0byBzaW5nIHVwIGluIHRoZSBzZXJ2ZXIuIGluIHRoZSBib2R5IHJjdiB0aGUgdXNlciBhbmQgcGFzc3dvcmRcbmFwcC5wb3N0KCcvYXBpL2FkZHBldCcsIChyZXEsIHJlcykgPT4ge1xuXG4gIGNvbnN0IHBldCA9IHJlcS5ib2R5LnBldFxuXG4gIGNvbnN0IHBldHMgPSBkYi5jb2xsZWN0aW9uKFwicGV0c1wiKTtcblxuICBwZXRzLmluc2VydE9uZShwZXQsIGZ1bmN0aW9uIChlcnIsIHJlc3BvbnNlKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgcmVzLnNlbmQoZXJyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQocmVzcG9uc2UpO1xuICAgIH1cbiAgfSk7XG5cblxuXG59KTtcblxuXG5hcHAucG9zdCgnL2FwaS9kZWxldGUvOl9pZCcsIChyZXEsIHJlcykgPT4ge1xuXG4gIGNvbnN0IHVzZXJQYXJhbSA9IHJlcS5wYXJhbXMuX2lkO1xuICBjb25zdCBwZXRzID0gZGIuY29sbGVjdGlvbihcInBldHNcIik7XG5cbiAgcGV0cy5kZWxldGVPbmUoeyBcIl9pZFwiOiBPYmplY3RJRCh1c2VyUGFyYW0pIH0sIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIHJlcy5zZW5kKGVycik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcy5zdGF0dXMoMjAwKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJlcy5zdGF0dXMoMjAwKTtcblxufSk7XG5cbi8vbG9hZCBvciBjcmVhdGUgbmV3IGNoYXQgaWYgZG9lcyBub3QgZXhpc3QgYSBwcmV2aW9zIGNoYXQgY29udmVyc2F0aW9uXG5hcHAucG9zdCgnL2FwaS9jaGF0LzpwYXJ0aWNpcGFudEEvOnBhcnRpY2lwYW50QicsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCB1c2VyQSA9IHJlcS5wYXJhbXMucGFydGljaXBhbnRBO1xuICBjb25zdCB1c2VyQiA9IHJlcS5wYXJhbXMucGFydGljaXBhbnRCO1xuICBjb25zdCBjaGF0cyA9IGRiLmNvbGxlY3Rpb24oXCJjaGF0c1wiKTtcblxuICBsZXQgYWN0Q2hhdCA9IGF3YWl0IGNoYXRzLmZpbmRPbmUoe1xuICAgICRvcjogW1xuICAgICAgeyAkYW5kOiBbeyBwYXJ0aWNpcGFudEE6IHVzZXJBIH0sIHsgcGFydGljaXBhbnRCOiB1c2VyQiB9XSB9LFxuICAgICAgeyAkYW5kOiBbeyBwYXJ0aWNpcGFudEE6IHVzZXJCIH0sIHsgcGFydGljaXBhbnRCOiB1c2VyQSB9XSB9XG4gICAgXVxuICB9KTtcbiAgLy8gaWYgdGhlIGNoYXQgZXhpc3RzXG4gIGlmIChhY3RDaGF0ICE9IG51bGwpIHtcbiAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChhY3RDaGF0Lm1lc3NhZ2VzKTtcbiAgfSBlbHNlIHtcblxuICAgIHZhciBuZXdDaGF0ID0ge1xuICAgICAgXCJwYXJ0aWNpcGFudEFcIjogdXNlckEsIFwicGFydGljaXBhbnRCXCI6IHVzZXJCLFxuICAgICAgbWVzc2FnZXM6IFtdXG4gICAgfTtcblxuICAgIGNoYXRzLmluc2VydE9uZShuZXdDaGF0LCBmdW5jdGlvbiAoZXJyLCByZXMpIHtcbiAgICAgIGlmIChlcnIpIHRocm93IGVycjtcbiAgICB9KTtcblxuICAgIHZhciBtZXNzYWdlcyA9IFtdO1xuICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKG1lc3NhZ2VzKTtcbiAgfVxufSk7XG5cbi8vIEFkZCBhIG5ldyBtZXNzYWdlIHRvIHRoZSBjb252ZXJzYXRpb25cbmFwcC5wb3N0KCcvYXBpL2NoYXQvYWRkbXNnLzpwYXJ0aWNpcGFudEEvOnBhcnRpY2lwYW50Qi86bXNnJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG5cbiAgY29uc3QgdXNlckEgPSByZXEucGFyYW1zLnBhcnRpY2lwYW50QTtcbiAgY29uc3QgdXNlckIgPSByZXEucGFyYW1zLnBhcnRpY2lwYW50QjtcbiAgY29uc3QgbXNnID0gcmVxLnBhcmFtcy5tc2c7XG4gIGNvbnN0IGNoYXRzID0gZGIuY29sbGVjdGlvbihcImNoYXRzXCIpO1xuXG4gIGxldCBhY3RDaGF0ID0gYXdhaXQgY2hhdHMuZmluZE9uZSh7XG4gICAgJG9yOiBbXG4gICAgICB7ICRhbmQ6IFt7IHBhcnRpY2lwYW50QTogdXNlckEgfSwgeyBwYXJ0aWNpcGFudEI6IHVzZXJCIH1dIH0sXG4gICAgICB7ICRhbmQ6IFt7IHBhcnRpY2lwYW50QTogdXNlckIgfSwgeyBwYXJ0aWNpcGFudEI6IHVzZXJBIH1dIH1cbiAgICBdXG4gIH0pO1xuICAvLyBpZiB0aGUgY2hhdCBleGlzdHNcbiAgaWYgKGFjdENoYXQgIT0gbnVsbCkge1xuXG4gICAgY2hhdHMudXBkYXRlT25lKFxuICAgICAge1xuICAgICAgICAkb3I6IFtcbiAgICAgICAgICB7ICRhbmQ6IFt7IHBhcnRpY2lwYW50QTogdXNlckEgfSwgeyBwYXJ0aWNpcGFudEI6IHVzZXJCIH1dIH0sXG4gICAgICAgICAgeyAkYW5kOiBbeyBwYXJ0aWNpcGFudEE6IHVzZXJCIH0sIHsgcGFydGljaXBhbnRCOiB1c2VyQSB9XSB9XG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7ICRhZGRUb1NldDogeyBtZXNzYWdlczogeyAkZWFjaDogW21zZ10gfSB9IH1cbiAgICApXG5cbiAgICBsZXQgYWN0Q2hhdCA9IGF3YWl0IGNoYXRzLmZpbmRPbmUoe1xuICAgICAgJG9yOiBbXG4gICAgICAgIHsgJGFuZDogW3sgcGFydGljaXBhbnRBOiB1c2VyQSB9LCB7IHBhcnRpY2lwYW50QjogdXNlckIgfV0gfSxcbiAgICAgICAgeyAkYW5kOiBbeyBwYXJ0aWNpcGFudEE6IHVzZXJCIH0sIHsgcGFydGljaXBhbnRCOiB1c2VyQSB9XSB9XG4gICAgICBdXG4gICAgfSk7XG5cbiAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChhY3RDaGF0Lm1lc3NhZ2VzKTtcblxuXG4gIH0gZWxzZSB7XG4gICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoXCJUaGUgY2hhdCBkbyBub3QgZXhpc3RzXCIpO1xuICB9XG59KTtcblxuXG4iXX0=
